---
title: "How to estimate the daily growth rate using the date of report stratified by groups?"
format: 
  html:
    code-link: true
editor: source
editor_options: 
  chunk_output_type: console
date: last-modified
toc: true
toc_float: true
---

```{r}
#| warning: false

library(tidyverse)
library(covidregionaldata)
library(i2extras)
library(incidence2)

raw_dat <- 
  covidregionaldataUK %>% 
  as_tibble() %>% 
  filter(magrittr::is_in(region,c("England", "Scotland", 
                                  "Northern Ireland", "Wales"))) %>% 
  filter(date > lubridate::ymd(20200701)) %>%
  filter(date < lubridate::ymd(20201101))

raw_dat %>%
  ggplot() +
  aes(x = date, y = cases_new, col = region) +
  geom_line()

# Convert the data to an incidence object
dat <- 
  incidence2::incidence(
    x = raw_dat, 
    counts = "cases_new",
    date_index = "date",
    interval = "day"
  )

dat

# Model the incidence
out <- 
  i2extras::fit_curve(
    dat, 
    model = "poisson", 
    alpha = 0.05
  )

# Print the result
i2extras::growth_rate(out)

# Plot the result with prediction intervals
plot(out, pi = TRUE)

# Stratify analysis by groups
dat_group <- 
  incidence2::incidence(
    x = raw_dat, 
    counts = "cases_new",
    date_index = "date",
    interval = "day",
    groups = "region"
  )

dat_group

# Model the incidence
out_group <- 
  i2extras::fit_curve(
    dat_group, 
    model = "poisson", 
    alpha = 0.05
  )

# Print the result
i2extras::growth_rate(out_group)

# Plot the result with prediction intervals
plot(out_group, pi = TRUE)
```

## Related

- [Explanation on incidence, growth rate, doubling time, and Poisson model](https://www.reconlearn.org/slides/outbreak-statistics/outbreak-statistics.html#28)
