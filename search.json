[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "You will learn how to complete a specific outbreak analytic task following concrete steps to solve a real-world problem."
  },
  {
    "objectID": "about.html#what-will-you-learn",
    "href": "about.html#what-will-you-learn",
    "title": "About",
    "section": "",
    "text": "You will learn how to complete a specific outbreak analytic task following concrete steps to solve a real-world problem."
  },
  {
    "objectID": "about.html#who-are-these-for",
    "href": "about.html#who-are-these-for",
    "title": "About",
    "section": "Who are these for?",
    "text": "Who are these for?\nIn the creation of these materials, we though in:\n\nJuan, a Data Analyst and R user in a National Health Agency with constant deployment to outbreak response.\nCelina, a Post-doc and fluent R user who needs to keep up-to-date with the latest package developments.\nDaniel, a Trainer that wants to remix content to create specific training materials for public health practitioners."
  },
  {
    "objectID": "about.html#design-principles",
    "href": "about.html#design-principles",
    "title": "About",
    "section": "Design Principles",
    "text": "Design Principles\n\nProvide a “How-to” guides as single point solutions to specific problems.\nAdd links to related Explanation documentation.\nShow the context (part of the pipeline), ingredients (packages) and steps.\nAdd brief interpretation templates.\nFunctions, as in package websites, should have code-link to their Reference documentation.\nProvide a “search by keyword” to find what a user needs.\nShow the R code needed to solve Outbreak Analytics tasks.\nShow how Epidemiology R packages are integrated in pipelines.\nHelp to identify which coding task can be replaced by new R packages.\nProvide various infectious disease scenarios by world regions and data sources.\nRefer to external learning resources.\nRefer to a glossary of terms.\nRefer to good coding practices."
  },
  {
    "objectID": "about.html#reproducibility",
    "href": "about.html#reproducibility",
    "title": "About",
    "section": "Reproducibility",
    "text": "Reproducibility\n\nNon-invasive package management with {renv}"
  },
  {
    "objectID": "about.html#related-projects",
    "href": "about.html#related-projects",
    "title": "About",
    "section": "Related projects",
    "text": "Related projects\n\nepirecipes"
  },
  {
    "objectID": "describe_cases/epiparameter_extract_epiparam.html",
    "href": "describe_cases/epiparameter_extract_epiparam.html",
    "title": "How to extract the serial interval distribution from a systematic review?",
    "section": "",
    "text": "Conditions:\n# Load required packages\nlibrary(epiparameter)\nlibrary(tidyverse)\n\n# Load the library of parameters as an epiparam object\nepiparam_all &lt;- epiparam()\n\n# Filter by disease, epi_distribution, region, and year\nepiparam_ebola &lt;- epiparam_all %&gt;% \n  filter(str_detect(disease,\"Ebola\")) %&gt;% \n  filter(epi_distribution == \"serial_interval\") %&gt;% \n  filter(region == \"West Africa\") %&gt;% \n  filter(year == 2015)\n\nepiparam_ebola\n\nEpiparam object\nNumber of distributions in library: 1\nNumber of diseases: 1\nNumber of delay distributions: 1\nNumber of offspring distributions: 0\nNumber of studies in library: 1\n&lt;Head of library&gt;\n              disease epi_distribution prob_distribution\n1 Ebola Virus Disease  serial_interval             gamma\n&lt;0 more rows & 53 more cols not shown&gt;\n\n# Convert a row to an epidist class object\nepidist_ebola &lt;- as_epidist(epiparam_ebola)\n\nepidist_ebola\n\nDisease: Ebola Virus Disease\nPathogen: Ebola Virus\nEpi Distribution: serial interval\nStudy: WHO Ebola Response Team (2015) &lt;10.1056/NEJMc1414992&gt; PMID: 25539446\nDistribution: gamma\nParameters:\n  shape: 2.188\n  scale: 6.490\n\n# Plot the epidist object\nplot(epidist_ebola,day_range = 0:50)"
  },
  {
    "objectID": "describe_cases/epiparameter_extract_epiparam.html#related",
    "href": "describe_cases/epiparameter_extract_epiparam.html#related",
    "title": "How to extract the serial interval distribution from a systematic review?",
    "section": "Related",
    "text": "Related\n\nExplanation on epidemiological distributions"
  },
  {
    "objectID": "describe_cases/growth_rate_day_i2extras_groups.html",
    "href": "describe_cases/growth_rate_day_i2extras_groups.html",
    "title": "How to estimate the growth rate stratified by groups?",
    "section": "",
    "text": "Conditions:\n# Calculate the daily growth rate of an outbreak stratified by groups\n\n# Load required packages\nlibrary(tidyverse)\nlibrary(covidregionaldata)\nlibrary(incidence2)\nlibrary(i2extras)\n\n# Load covid outbreak data\nraw_dat &lt;- \n  covidregionaldataUK %&gt;% \n  as_tibble() %&gt;% \n  filter(magrittr::is_in(region,c(\"England\", \"Scotland\", \n                                  \"Northern Ireland\", \"Wales\"))) %&gt;% \n  filter(date &gt; lubridate::ymd(20200701)) %&gt;%\n  filter(date &lt; lubridate::ymd(20201101))\n\n# Plot the raw data\nraw_dat %&gt;%\n  ggplot() +\n  aes(x = date, y = cases_new) +\n  geom_line() +\n  facet_wrap(vars(region))\n\n\n\n# Convert the data to an incidence object stratified by groups\ndat_group &lt;- \n  incidence2::incidence(\n    x = raw_dat, \n    counts = \"cases_new\",\n    date_index = \"date\",\n    interval = \"day\",\n    groups = \"region\"\n  )\n\ndat_group\n\n# incidence:  488 x 4\n# count vars: cases_new\n# groups:     region\n   date_index region           count_variable count\n * &lt;date&gt;     &lt;chr&gt;            &lt;fct&gt;          &lt;dbl&gt;\n 1 2020-07-02 England          cases_new        565\n 2 2020-07-02 Northern Ireland cases_new          3\n 3 2020-07-02 Scotland         cases_new         13\n 4 2020-07-02 Wales            cases_new         28\n 5 2020-07-03 England          cases_new        543\n 6 2020-07-03 Northern Ireland cases_new          8\n 7 2020-07-03 Scotland         cases_new          6\n 8 2020-07-03 Wales            cases_new         19\n 9 2020-07-04 England          cases_new        386\n10 2020-07-04 Northern Ireland cases_new          1\n# ℹ 478 more rows\n\n# Model the incidence\nout_group &lt;- \n  i2extras::fit_curve(\n    dat_group, \n    model = \"poisson\", \n    alpha = 0.05\n  )\n\n# Print the model result\ni2extras::growth_rate(out_group)\n\n# A tibble: 4 × 10\n  count_variable region       model      r r_lower r_upper growth_or_decay  time\n  &lt;fct&gt;          &lt;chr&gt;        &lt;lis&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;\n1 cases_new      England      &lt;glm&gt; 0.0385  0.0384  0.0386 doubling         18.0\n2 cases_new      Northern Ir… &lt;glm&gt; 0.0438  0.0433  0.0443 doubling         15.8\n3 cases_new      Scotland     &lt;glm&gt; 0.0406  0.0402  0.0410 doubling         17.1\n4 cases_new      Wales        &lt;glm&gt; 0.0447  0.0443  0.0452 doubling         15.5\n# ℹ 2 more variables: time_lower &lt;dbl&gt;, time_upper &lt;dbl&gt;\n\n# Plot the model result with prediction intervals\nplot(out_group, ci = FALSE, pi = TRUE)\n\n\n\n# Read plot documentation for an incidence2_fit object\n# ?plot.incidence2_fit"
  },
  {
    "objectID": "describe_cases/growth_rate_day_i2extras_groups.html#related",
    "href": "describe_cases/growth_rate_day_i2extras_groups.html#related",
    "title": "How to estimate the growth rate stratified by groups?",
    "section": "Related",
    "text": "Related\n\nExplanation on incidence, growth rate, doubling time, and Poisson model"
  },
  {
    "objectID": "describe_cases/growth_rate_week_i2extras.html",
    "href": "describe_cases/growth_rate_week_i2extras.html",
    "title": "How to estimate the growth rate?",
    "section": "",
    "text": "Conditions:\n# Calculate the weekly growth rate of an outbreak\n\n# Load required packages\nlibrary(outbreaks)\nlibrary(incidence2)\nlibrary(i2extras)\nlibrary(dplyr)\n\n# Load the simulated Ebola outbreak data\ndata(ebola_sim_clean)\n\n# Extract the first element of the list\nlinelist &lt;- ebola_sim_clean$linelist\n\n# Convert the data to an incidence2 object\nincidence2_data &lt;- \n  incidence2::incidence(\n    x = linelist, \n    date_index = \"date_of_onset\",\n    interval = \"week\"\n  )\n\n# Filter the dataset to keep the first 20 weeks. \nincidence2_filter &lt;- incidence2_data[1:20,]\n\n# Model the incidence\nincidence2_fit &lt;- \n  i2extras::fit_curve(\n    incidence2_filter, \n    model = \"poisson\", \n    alpha = 0.05\n  )\n\n# Print the model result\ni2extras::growth_rate(incidence2_fit)\n\n# A tibble: 1 × 9\n  count_variable model      r r_lower r_upper growth_or_decay  time time_lower\n  &lt;chr&gt;          &lt;list&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;\n1 date_of_onset  &lt;glm&gt;  0.184   0.168   0.200 doubling         3.77       3.46\n# ℹ 1 more variable: time_upper &lt;dbl&gt;\n\n# Plot the model result with prediction intervals\nplot(incidence2_fit, ci = FALSE, pi = TRUE)\n\n\n\n# Read plot documentation for an incidence2_fit object\n# ?plot.incidence2_fit\nPlease note that the code assumes the necessary packages are already installed. If they are not, you can install them using first the install.packages(\"pak\") function and then the pak::pak() function for both packages in CRAN or GitHub before loading them with library().\nAdditionally, make sure to adjust the serial interval distribution parameters according to the specific outbreak you are analyzing."
  },
  {
    "objectID": "describe_cases/growth_rate_week_i2extras.html#related",
    "href": "describe_cases/growth_rate_week_i2extras.html#related",
    "title": "How to estimate the growth rate?",
    "section": "Related",
    "text": "Related\n\nExplanation on incidence, growth rate, doubling time, and Poisson model"
  },
  {
    "objectID": "forecast_cases/projections_incidence_epitrix.html",
    "href": "forecast_cases/projections_incidence_epitrix.html",
    "title": "How to project the future trajectory of the outbreak?",
    "section": "",
    "text": "Conditions:\n\nProject the future daily incidence based of past incidence, a selection of plausible basic reproduction numbers, and the distribution of the serial interval, using the projections package.\nGet the basic reproductive number from the growth rate, given a generation time distribution, using the epitrix package.\nUse the serial interval time as proxy of the generation time.\nUse the serial interval distribution parameters of Ebola Virus Disease estimated from the WHO Ebola Response Team in 2015.\nUse the linelist from the Simulated Ebola outbreak ebola_sim_clean object from the outbreaks R package.\nKeep the first 48 weeks as period of analysis.\nUse the date of onset column to calculate the daily growth rate.\n\n\n# Project the future trajectory of the outbreak\n\n# Load required packages\nlibrary(outbreaks)\nlibrary(incidence2)\nlibrary(i2extras)\nlibrary(epiparameter)\nlibrary(distcrete)\nlibrary(epitrix)\nlibrary(projections)\nlibrary(tidyverse)\n\n# Load the simulated Ebola outbreak data\ndata(ebola_sim_clean)\n\n# Extract the first element of the list\nlinelist &lt;- ebola_sim_clean$linelist\n\n# Convert the data to an incidence2 object\nincidence2_data &lt;- \n  incidence2::incidence(\n    x = linelist, \n    date_index = \"date_of_onset\",\n    interval = \"day\"\n  )\n\n# Filter the incidence2 object to keep the first 48 weeks. \nincidence2_filter &lt;- incidence2_data[1:48,]\n\n# Convert the filtered incidence2 object to an incidence object\nincidence1_filter &lt;- \n  incidence2_filter %&gt;% \n  tidyr::uncount(count) %&gt;% \n  dplyr::pull(date_index) %&gt;% \n  incidence::incidence()\n\n# Model the incidence\nincidence2_fit &lt;- \n  i2extras::fit_curve(\n    x = incidence2_filter,\n    model = \"poisson\",\n    alpha = 0.05\n  )\n\n# Extract parameter by disease, distribution, author\nepidist_ebola_si &lt;- \n  epiparameter::epidist_db(\n    disease = \"Ebola\",\n    epi_dist = \"serial_interval\",\n    author = \"WHO_Ebola_Response_Team\"\n  )\n\n# Read epidist class object\n# Read distribution: gamma\nepidist_ebola_si\n\nDisease: Ebola Virus Disease\nPathogen: Ebola Virus\nEpi Distribution: serial interval\nStudy: WHO Ebola Response Team (2015) &lt;10.1056/NEJMc1414992&gt; PMID: 25539446\nDistribution: gamma\nParameters:\n  shape: 2.188\n  scale: 6.490\n\n# Discretise the distribution\ndiscrete_ebola_si &lt;- epiparameter::discretise(epidist_ebola_si)\n\n# Now read distribution: discrete gamma\ndiscrete_ebola_si\n\nDisease: Ebola Virus Disease\nPathogen: Ebola Virus\nEpi Distribution: serial interval\nStudy: WHO Ebola Response Team (2015) &lt;10.1056/NEJMc1414992&gt; PMID: 25539446\nDistribution: discrete gamma\nParameters:\n  shape: 2.188\n  scale: 6.490\n\n# Transform from 'epidist' class to 'distcrete' class object\ndistcrete_ebola_si &lt;- \n  distcrete::distcrete(\n    name = \"gamma\",\n    shape = discrete_ebola_si$prob_dist$parameters$shape,\n    scale = discrete_ebola_si$prob_dist$parameters$scale,\n    interval = discrete_ebola_si$prob_dist$interval,\n    w = discrete_ebola_si$prob_dist$w\n  )\n\n# Read distcrete class object\ndistcrete_ebola_si\n\nA discrete distribution\n  name: gamma\n  parameters:\n    shape: 2.18793402777778\n    scale: 6.49014084507042\n\n# Transform growth rate into reproductive number\nreproductive_basic &lt;- \n  epitrix::lm2R0_sample(\n    x = incidence2_fit %&gt;% \n      pull(model) %&gt;% \n      pluck(1),\n    w = discrete_ebola_si$prob_dist,\n    n = 500\n  )\n\n# Write function to sample replicates of reproductive number\nsample_function &lt;- \n  function(x = reproductive_basic, n_sim = 1000){\n    mu &lt;- mean(x)\n    sigma &lt;- sd(x)\n    shape_scale &lt;- epitrix::gamma_mucv2shapescale(\n      mu = mu, \n      cv = sigma / mu\n    )\n    sample_result &lt;- rgamma(\n      n = n_sim, \n      shape = shape_scale$shape, \n      scale = shape_scale$scale\n    )\n    return(sample_result)\n  }\n\n# Run function to sample replicates of reproductive number\nreproductive_basic_sample &lt;- \n  sample_function(\n    x = reproductive_basic,\n    n_sim = 1000\n  )\n\n# Plot the sample distribution\nhist(reproductive_basic_sample)\n\n\n\n# Project the future incidence \n# from incidence object and sample of basic reproductive number\nincidence1_projection &lt;- \n  projections::project(\n    x = incidence1_filter, \n    R = reproductive_basic_sample,\n    si = distcrete_ebola_si, \n    n_sim = 1000, \n    n_days = 14, \n    R_fix_within = TRUE\n  )\n\n# Plot the incidence object with the projection\nincidence1_filter %&gt;% \n  plot() %&gt;% \n  add_projections(\n    x = incidence1_projection,\n    quantiles = c(0.025, 0.5, 0.975)\n  )\n\n\n\n\nRelated:\n\nExplanation on projections"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Get started",
    "section": "",
    "text": "The goal of howto is to collect reproducible How to guides of Outbreak data analysis tasks using R packages."
  },
  {
    "objectID": "index.html#describe-case-data",
    "href": "index.html#describe-case-data",
    "title": "Get started",
    "section": "Describe case data",
    "text": "Describe case data\n\n\n   \n     \n     \n       Order By\n       Default\n         \n          Title\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\n\nTitle\n\n\n\n\n\n\nHow to estimate the growth rate stratified by groups?\n\n\n\n\nHow to estimate the growth rate?\n\n\n\n\nHow to extract the serial interval distribution from a systematic review?\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html#quantify-transmission",
    "href": "index.html#quantify-transmission",
    "title": "Get started",
    "section": "Quantify transmission",
    "text": "Quantify transmission\n\n\n   \n     \n     \n       Order By\n       Default\n         \n          Title\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\n\nTitle\n\n\n\n\n\n\nHow to quantify the time-varying reproduction number (Rt)?\n\n\n\n\nHow to simulate the effective reproductive number (Reff) with heterogeneity in social contact?\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html#create-short-term-forecast",
    "href": "index.html#create-short-term-forecast",
    "title": "Get started",
    "section": "Create short-term forecast",
    "text": "Create short-term forecast\n\n\n   \n     \n     \n       Order By\n       Default\n         \n          Title\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\n\nTitle\n\n\n\n\n\n\nHow to project the future trajectory of the outbreak?\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html#simulate-transmission-scenarios",
    "href": "index.html#simulate-transmission-scenarios",
    "title": "Get started",
    "section": "Simulate transmission scenarios",
    "text": "Simulate transmission scenarios\n\n\n   \n     \n     \n       Order By\n       Default\n         \n          Title\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\n\nTitle\n\n\n\n\n\n\nHow to create heterogeneous susceptibility matrices?\n\n\n\n\nHow to simulate the final size with heterogeneity in social contact and infection susceptibility?\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html#more",
    "href": "index.html#more",
    "title": "Get started",
    "section": "More",
    "text": "More\nRefer to the About page for more details about the rationale behind the design of this site."
  },
  {
    "objectID": "quantify_transmission/finalsize_effective_reproduction_number.html",
    "href": "quantify_transmission/finalsize_effective_reproduction_number.html",
    "title": "How to simulate the effective reproductive number (Reff) with heterogeneity in social contact?",
    "section": "",
    "text": "Conditions:\nlibrary(finalsize)\nlibrary(socialmixr)\nlibrary(tidyverse)\n\n# get UK polymod data\npolymod &lt;- socialmixr::polymod\ncontact_data &lt;- socialmixr::contact_matrix(\n  polymod,\n  countries = \"United Kingdom\",\n  age.limits = c(0, 5, 18, 40, 65),\n  symmetric = TRUE\n)\n\n# get the contact matrix and demography data\ncontact_matrix &lt;- t(contact_data$matrix)\n\n# scale the contact matrix so the largest eigenvalue is 1.0\n# this is to ensure that the overall epidemic dynamics correctly reflect\n# the assumed value of R0\ncontact_matrix_scaled &lt;- contact_matrix / max(Re(eigen(contact_matrix)$values))\n\n# Define population in each age group\ndemography_vector &lt;- contact_data$demography$population\ndemography_groups &lt;- contact_data$demography$age.group\n\ndemography_vector\n\n[1]  3453670  9761554 18110368 19288101  9673058\n\ndemography_groups\n\n[1] \"[0,5)\"   \"[5,18)\"  \"[18,40)\" \"[40,65)\" \"65+\"    \n\n# divide each row of the contact matrix by the corresponding demography\n# this reflects the assumption that each individual in group {j} make contacts\n# at random with individuals in group {i}\ncontact_matrix_random &lt;- contact_matrix_scaled / demography_vector\n\n# Define susceptibility of each group\n# susceptibility matrix\nsusceptibility &lt;- tibble(\n  age_group = demography_groups,\n  susceptible = c(0.8, 0.8, 0.8, 0.8, 0.8)\n) %&gt;%\n  column_to_rownames(var = \"age_group\") %&gt;%\n  as.matrix()\n\nsusceptibility\n\n        susceptible\n[0,5)           0.8\n[5,18)          0.8\n[18,40)         0.8\n[40,65)         0.8\n65+             0.8\n\n# Assume uniform susceptibility within age groups\n# demography-in-susceptibility matrix\np_susceptibility &lt;- tibble(\n  age_group = demography_groups,\n  susceptible = c(1.0, 1.0, 1.0, 1.0, 1.0)\n) %&gt;%\n  column_to_rownames(var = \"age_group\") %&gt;%\n  as.matrix()\n\np_susceptibility\n\n        susceptible\n[0,5)             1\n[5,18)            1\n[18,40)           1\n[40,65)           1\n65+               1\n\n# R0 of the disease\nr0 &lt;- 1.5 # assumed for pandemic influenza\n\n# calculate the effective R0 using `r_eff()`\nr_eff(\n  r0 = r0,\n  contact_matrix = contact_matrix_random,\n  demography_vector = demography_vector,\n  susceptibility = susceptibility,\n  p_susceptibility = p_susceptibility\n)\n\n[1] 1.2"
  },
  {
    "objectID": "quantify_transmission/finalsize_effective_reproduction_number.html#related",
    "href": "quantify_transmission/finalsize_effective_reproduction_number.html#related",
    "title": "How to simulate the effective reproductive number (Reff) with heterogeneity in social contact?",
    "section": "Related",
    "text": "Related\n\nExplanation on effective reproductive number"
  },
  {
    "objectID": "quantify_transmission/reproduction_number_basic_epiestim_parametric.html",
    "href": "quantify_transmission/reproduction_number_basic_epiestim_parametric.html",
    "title": "How to quantify the time-varying reproduction number (Rt)?",
    "section": "",
    "text": "Conditions:\n# Quantify the time-varying reproduction number (Rt) of the outbreak\n\n# Load required packages\nlibrary(outbreaks)\nlibrary(incidence)\nlibrary(epiparameter)\nlibrary(EpiEstim)\nlibrary(tidyverse)\n\n# Load the simulated Ebola outbreak data\ndata(ebola_sim_clean)\n\n# Extract the first element of the list\nlinelist &lt;- ebola_sim_clean$linelist\n\n# Convert the data to an incidence object\nincidence_data &lt;- incidence::incidence(linelist$date_of_onset)\n\n# Extract parameter by disease, distribution, author\nepidist_ebola &lt;- epidist_db(\n  disease = \"Ebola\",\n  epi_dist = \"serial_interval\",\n  author = \"WHO_Ebola_Response_Team\"\n)\n\n# Estimate the time-varying reproduction number\nepiestim_output &lt;- estimate_R(\n  incid = incidence_data, \n  method = \"parametric_si\",\n  config = make_config(\n    mean_si = epidist_ebola$summary_stats$centre_spread$mean,\n    std_si = epidist_ebola$summary_stats$centre_spread$sd\n  )\n)\n\n# Plot the time-varying reproduction number\nplot(epiestim_output)\nPlease note that the code assumes the necessary packages are already installed. If they are not, you can install them using first the install.packages(\"pak\") function and then the pak::pak() function for both packages in CRAN or GitHub before loading them with library().\nAdditionally, make sure to adjust the serial interval distribution parameters according to the specific outbreak you are analyzing."
  },
  {
    "objectID": "quantify_transmission/reproduction_number_basic_epiestim_parametric.html#related",
    "href": "quantify_transmission/reproduction_number_basic_epiestim_parametric.html#related",
    "title": "How to quantify the time-varying reproduction number (Rt)?",
    "section": "Related",
    "text": "Related\n\nExplanation on effective reproductive number"
  },
  {
    "objectID": "simulate_cases/finalsize_heterogenious_between_within.html",
    "href": "simulate_cases/finalsize_heterogenious_between_within.html",
    "title": "How to simulate the final size with heterogeneity in social contact and infection susceptibility?",
    "section": "",
    "text": "This scenario assumes that, in the population, there is:\n# Simulate final size with heterogeneity in social contact and infection susceptibility\n\nlibrary(finalsize)\nlibrary(socialmixr)\nlibrary(tidyverse)\n\n# get UK polymod data\npolymod &lt;- socialmixr::polymod\ncontact_data &lt;- socialmixr::contact_matrix(\n  polymod,\n  countries = \"United Kingdom\",\n  age.limits = c(0, 5, 18, 40, 65),\n  symmetric = TRUE\n)\n\n# get the contact matrix and demography data\ncontact_matrix &lt;- t(contact_data$matrix)\n\n# scale the contact matrix so the largest eigenvalue is 1.0\n# this is to ensure that the overall epidemic dynamics correctly reflect\n# the assumed value of R0\ncontact_matrix_scaled &lt;- contact_matrix / max(Re(eigen(contact_matrix)$values))\n\n# Define population in each age group\ndemography_vector &lt;- contact_data$demography$population\ndemography_groups &lt;- contact_data$demography$age.group\n\ndemography_vector\n\n[1]  3453670  9761554 18110368 19288101  9673058\n\ndemography_groups\n\n[1] \"[0,5)\"   \"[5,18)\"  \"[18,40)\" \"[40,65)\" \"65+\"    \n\n# divide each row of the contact matrix by the corresponding demography\n# this reflects the assumption that each individual in group {j} make contacts\n# at random with individuals in group {i}\ncontact_matrix_random &lt;- contact_matrix_scaled / demography_vector\n\n\n# Set and immunization effect\nimmunization_effect &lt;- 0.25\n\n# susceptibility matrix\nsusceptibility &lt;- tibble(\n  age_group = demography_groups,\n  unimmunised = c(0.2, 0.5, 0.6, 0.9, 1.0)\n) %&gt;%\n  mutate(immunised = unimmunised * (1 - immunization_effect)) %&gt;%\n  column_to_rownames(var = \"age_group\") %&gt;%\n  as.matrix()\n\nsusceptibility\n\n        unimmunised immunised\n[0,5)           0.2     0.150\n[5,18)          0.5     0.375\n[18,40)         0.6     0.450\n[40,65)         0.9     0.675\n65+             1.0     0.750\n\n# demography-in-susceptibility matrix\np_susceptibility &lt;- tibble(\n  age_group = demography_groups,\n  immunised = c(0.2, 0.4, 0.6, 0.7, 0.9)\n) %&gt;%\n  mutate(unimmunised = 1 - immunised) %&gt;%\n  column_to_rownames(var = \"age_group\") %&gt;%\n  as.matrix()\n\np_susceptibility\n\n        immunised unimmunised\n[0,5)         0.2         0.8\n[5,18)        0.4         0.6\n[18,40)       0.6         0.4\n[40,65)       0.7         0.3\n65+           0.9         0.1\n\n# R0 of the disease\nr0 &lt;- 1.5 # assumed for pandemic influenza\n\n# Calculate the proportion of individuals infected in each age group\nfinal_size(\n  r0 = r0,\n  contact_matrix = contact_matrix_random,\n  demography_vector = demography_vector,\n  susceptibility = susceptibility,\n  p_susceptibility = p_susceptibility\n)\n\n   demo_grp    susc_grp susceptibility   p_infected\n1     [0,5) unimmunised          0.200 4.499231e-08\n2    [5,18) unimmunised          0.500 2.406152e-07\n3   [18,40) unimmunised          0.600 2.247908e-07\n4   [40,65) unimmunised          0.900 2.849580e-07\n5       65+ unimmunised          1.000 1.847858e-07\n6     [0,5)   immunised          0.150 3.374423e-08\n7    [5,18)   immunised          0.375 1.804614e-07\n8   [18,40)   immunised          0.450 1.685931e-07\n9   [40,65)   immunised          0.675 2.137185e-07\n10      65+   immunised          0.750 1.385893e-07"
  },
  {
    "objectID": "simulate_cases/finalsize_heterogenious_between_within.html#related",
    "href": "simulate_cases/finalsize_heterogenious_between_within.html#related",
    "title": "How to simulate the final size with heterogeneity in social contact and infection susceptibility?",
    "section": "Related",
    "text": "Related"
  },
  {
    "objectID": "simulate_cases/finalsize_heterogenious_between_within.html#related-1",
    "href": "simulate_cases/finalsize_heterogenious_between_within.html#related-1",
    "title": "How to simulate the final size with heterogeneity in social contact and infection susceptibility?",
    "section": "Related",
    "text": "Related\n\nExplanation on heterogeneous susceptibility"
  },
  {
    "objectID": "simulate_cases/finalsize_susceptibility_matrices.html",
    "href": "simulate_cases/finalsize_susceptibility_matrices.html",
    "title": "How to create heterogeneous susceptibility matrices?",
    "section": "",
    "text": "Conditions:\n# Load required packages\nlibrary(tidyverse)\n\n# Define the immunization effect\nimmunization_effect &lt;- 0.25\n\n# Create the susceptibility matrix\nsusceptibility &lt;- \n  tribble(\n    ~age_group, ~unimmunised,\n       \"[0,5)\",          0.2,\n      \"[5,18)\",          0.5,\n     \"[18,40)\",          0.6,\n     \"[40,65)\",          0.9,\n         \"65+\",            1\n  ) %&gt;%\n  mutate(immunised = unimmunised * (1 - immunization_effect)) %&gt;%\n  column_to_rownames(var = \"age_group\") %&gt;%\n  as.matrix()\n\nsusceptibility\n\n        unimmunised immunised\n[0,5)           0.2     0.150\n[5,18)          0.5     0.375\n[18,40)         0.6     0.450\n[40,65)         0.9     0.675\n65+             1.0     0.750\n\n# Create the demography-in-susceptibility matrix\np_susceptibility &lt;- \n  tribble(\n    ~age_group, ~unimmunised,\n       \"[0,5)\",          0.6,\n      \"[5,18)\",          0.6,\n     \"[18,40)\",          0.6,\n     \"[40,65)\",          0.6,\n         \"65+\",          0.6\n  ) %&gt;%\n  mutate(immunised = 1 - unimmunised) %&gt;%\n  column_to_rownames(var = \"age_group\") %&gt;%\n  as.matrix()\n\np_susceptibility\n\n        unimmunised immunised\n[0,5)           0.6       0.4\n[5,18)          0.6       0.4\n[18,40)         0.6       0.4\n[40,65)         0.6       0.4\n65+             0.6       0.4\nPlease note that the code assumes the necessary packages are already installed. If they are not, you can install them using first the install.packages(\"pak\") function and then the pak::pak() function for both packages in CRAN or GitHub before loading them with library()."
  },
  {
    "objectID": "simulate_cases/finalsize_susceptibility_matrices.html#related",
    "href": "simulate_cases/finalsize_susceptibility_matrices.html#related",
    "title": "How to create heterogeneous susceptibility matrices?",
    "section": "Related",
    "text": "Related\n\nExplanation of susceptibility matrices for the finalsize package"
  }
]